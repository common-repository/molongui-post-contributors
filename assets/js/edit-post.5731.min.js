class molonguiPostContributorsPostEdit{static PROFILE="contributor";static CONTAINER="";static JS_VAR="molongui_contributors_contributors_metabox_params";constructor(){jQuery(document).ready(()=>{this.initEventListeners(),this.initDomElements()})}initEventListeners(){jQuery(document).ajaxSend((o,t,r)=>{var i;-1!=r.url.indexOf(molongui_contributors_contributors_metabox_params.ajax_suggest_link)&&(i=jQuery('input[name^="contributors["]').map(function(){return this.value}).get(),r.url=r.url.split("&existing_contributors")[0],r.url+="&existing_contributors="+i.join(","),jQuery("#contributors-loading").css("visibility","visible"))}),jQuery(document).ajaxComplete((o,t,r)=>{-1!=r.url.indexOf(molongui_contributors_contributors_metabox_params.ajax_suggest_link)&&jQuery("#contributors-loading").css("visibility","hidden")}),jQuery(document).on("click.molongui",".molongui-post-contributors__up",o=>{var o=jQuery(o.target).closest(".molongui-post-contributors__item"),t=o.prev(".molongui-post-contributors__item");0!==t.length&&o.insertBefore(t)}),jQuery(document).on("click.molongui",".molongui-post-contributors__down",o=>{var o=jQuery(o.target).closest(".molongui-post-contributors__item"),t=o.next(".molongui-post-contributors__item");0!==t.length&&o.insertAfter(t)}),jQuery(document).on("click.molongui",".molongui-post-contributors__delete",o=>{o.preventDefault(),this.deleteContributorOnClick(o)}),jQuery("body").on("change.molongui","select.molongui-post-contributors__role",o=>{var t,r,o=jQuery(o.target),i=o.closest(".molongui-post-contributors__item");jQuery(i).find('input[type="hidden"].molongui-post-contributors__contributorData').attr("name","molongui_post_contributors["+o.val()+"][]"),molongui_contributors_contributors_metabox_params.debug_mode&&(t=i.data("contributor-id"),r=i.data("contributor-name"),i=i.data("contributor-nicename"),console.log("Role changed to "+o.val()+" for "+r+"(#"+t+", "+i+")"))}),jQuery(document).on("contributorAdded.molongui",o=>{jQuery(".molongui-post-contributors__roles").show()}),jQuery(document).on("contributorDeleted.molongui",o=>{0===jQuery(".molongui-post-contributors__list .molongui-post-contributors__item").length&&jQuery(".molongui-post-contributors__roles").hide()})}initDomElements(){this.initSearchBox(jQuery(".molongui-post-contributors__input"))}initContributorSelector(o){o&&(this.initSearchBox(o.find(".molongui-post-contributors__input")),this.initSortableList(o.find(".molongui-post-contributors___list")))}initSearchBox(o){o&&o.suggest(molongui_contributors_contributors_metabox_params.ajax_suggest_link,{onSelect:()=>{this.autosuggestSelect(o[0],o)},delay:200,maxCacheSize:0}).on("keydown",this.disableKeydown.bind(this))}autosuggestSelect(o,t){var r,o=o.value.split("âˆ£");1<o.length&&((r={}).name=o[0].trim(),r.type=o[1].trim(),r.id=o[2].replace(/\(#(\d+)\)/,"$1").trim(),r.email=o[3].trim(),r.login=o[4].trim(),r.nicename=decodeURIComponent(o[5].trim()),r.avatar=o[6].trim(),r.role=o[7].trim(),r.type="Guest"===r.type?"guest":"user",0===jQuery(".molongui-post-contributors__list").find(".molongui-post-contributors__item[data-contributor-ref="+r.type+"-"+r.id+"]").length)&&this.addContributor(r),t.val("").blur(),this.resetSearchBox(t)}disableKeydown(o){if(13===o.keyCode)return!1}addContributor(o){let t="";o.avatar&&(r=jQuery("<img />").attr("src",o.avatar),t=jQuery("<div/>").addClass("molongui-post-contributors__avatar").append(r));var r=jQuery("<div/>").addClass("molongui-post-contributors__name").text(decodeURIComponent(o.name)).attr("title",molongui_contributors_contributors_metabox_params.tag_title);jQuery("<div/>").addClass("molongui-post-contributors__as").text(molongui_contributors_contributors_metabox_params.as_label);let i=jQuery("<select/>").addClass("molongui-post-contributors__role");jQuery.each(molongui_contributors_contributors_metabox_params.contributor_roles,function(o,t){i.append(jQuery("<option>",{value:t.value,text:t.text}))}),i.val(o.role).change();var n=jQuery("<span> </span>").addClass("dashicons").addClass("dashicons-arrow-up-alt2").addClass("molongui-post-contributors__up").attr("title",molongui_contributors_contributors_metabox_params.up_label),e=jQuery("<span> </span>").addClass("dashicons").addClass("dashicons-arrow-down-alt2").addClass("molongui-post-contributors__down").attr("title",molongui_contributors_contributors_metabox_params.down_label),s=jQuery("<span> </span>").addClass("dashicons").addClass("dashicons-no-alt").addClass("molongui-post-contributors__delete").attr("title",molongui_contributors_contributors_metabox_params.delete_label),n=jQuery("<div/>").addClass("molongui-post-contributors__actions").append(n).append(e).append(s),e=jQuery("<input />").attr({type:"hidden",class:"molongui-post-contributors__contributorData",name:"molongui_post_contributors["+o.role+"][]",value:decodeURIComponent(o.nicename)});let u="";void 0!==molongui_contributors_contributors_metabox_params.extra&&(u=jQuery("<input />").attr({type:"hidden",class:"molongui-post-contributors__contributorOrder",name:"molongui_post_contributors_order[]",value:decodeURIComponent(o.nicename+"__AKA__"+o.name+"__AS__"+o.role)}));s=jQuery("<div/>").addClass("molongui-post-contributors__column").append(r).append(i),r=jQuery("<div/>").addClass("molongui-post-contributors__row").append(t).append(s).append(n).append(e).append(u),s=jQuery("<div/>").attr("id","contributor-"+o.id).addClass("molongui-post-contributors__item").addClass("molongui-post-contributors__item--"+o.type).attr("data-contributor-id",o.id).attr("data-contributor-type",o.type).attr("data-contributor-ref",o.type+"-"+o.id).attr("data-contributor-name",o.name).attr("data-contributor-nicename",o.nicename).append(r);jQuery(".molongui-post-contributors__list").first().append(s),jQuery(document).trigger("contributorAdded"),molongui_contributors_contributors_metabox_params.debug_mode&&console.log("Contributor added: "+o.name+" ("+o.type+", #"+o.id+")")}resetSearchBox(o){var t=o.clone();t.insertBefore("#contributors-loading"),this.initSearchBox(t),o.remove()}deleteContributorOnClick(o){var t=molongui_contributors_contributors_metabox_params.confirm_delete;return!!confirm(t)&&this.deleteContributor(o.target)}deleteContributor(o){o=jQuery(o).closest(".molongui-post-contributors__item");return o.remove(),jQuery(document).trigger("contributorDeleted",[o]),!0}}jQuery(document).ready(()=>{window.molonguiPostContributorsPostEdit=new molonguiPostContributorsPostEdit}),window.molonguiPostContributorsInitContributorSelector=o=>{window.molonguiPostContributorsPostEdit&&window.molonguiPostContributorsPostEdit.initContributorSelector(o)},jQuery(document).ready(function(){jQuery(document).on("focus",".molongui-post-contributors__input",function(){$this=jQuery(this),0<jQuery(".molongui-post-contributors__list").children(".molongui-post-contributors__item").length&&(alert(molongui_contributors_contributors_metabox_params.limit_reached_text),$this.prop("disabled",!0))}),jQuery(document).on("contributorDeleted",function(o){jQuery(".molongui-post-contributors__list").children(".molongui-post-contributors__item").length<1&&jQuery(".molongui-post-contributors__input").prop("disabled",!1)})});